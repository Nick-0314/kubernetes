# kubernetes
此文档为第一篇 后续会尽快更新

本文档主要介绍在裸机环境下以二进制的方式安装部署kubernetes

本次文档主要是对于kubernetes 1.16.1版本

内容主要有环境准备安装配置docker 升级内核 调整系统参数

环境准备

三台机器 2核cpu 4G内存  连接公网

主机名     IP     

master    192.168.10.10

node1     192.168.10.11

node2     192.168.10.12

主要步骤

  三台节点见互相配置免密登陆和主机名解析 包括对自己

  安装docker

  配置docker

  升级内核

  调整系统参数
 
  重启节点

安装docker：
　
添加yun源

	tee /etc/yum.repos.d/docker-ce.repo <<-'EOF'
	[aliyun-docker-ce]
	name=aliyun-docker-ce
	baseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/7/x86_64/stable/
	enable=1
	gpgcheck=1
	gpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg
	EOF
  
  安装docker-ce
	
	yum -y install docker-ce

  安装完之后 编辑docker配置文件添加 docker加速器 私有仓库 和修改控制节点cgroups为cgroups为 systemd 

	sed  -i "s|ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock|ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock    --exec-opt native.cgroupdriver=systemd|" /usr/lib/systemd/system/docker.service

  重启docker并设置为开机自启

	systemctl daemon-reload
	systemctl restart docker
	systemctl enable docker

升级内核
	
  安装内核语言编译器（内核是用perl语言编写的）
　　
	yum -y install perl

  下载密钥和yum源
　　
  导入密钥
　　
	rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
    
  安装7版本的yum源文件

	yum -y install https://www.elrepo.org/elrepo-release-7.0-4.el7.elrepo.noarch.rpm

  安装 ml版本 5版本的内核名字叫ml

	yum  --enablerepo="elrepo-kernel"  -y install kernel-ml.x86_64
　　
  然后配置从新的内核启动

	grub2-set-default 0

  然后重新生成grub2.cfg 使虚拟机使用新内核启动

	grub2-mkconfig -o /boot/grub2/grub.cfg
　　
调整系统参数

配置内核参数，开启路由转发 将桥接的IPv4流量传递到iptables的链  禁用swap分区
	
	echo "net.ipv4.ip_forward = 1" >> /etc/sysctl.conf
	echo "net.bridge.bridge-nf-call-ip6tables = 1" >> /etc/sysctl.conf
	echo "net.bridge.bridge-nf-call-iptables = 1" >> /etc/sysctl.conf    
	echo "vm.swappiness=0" >> /etc/sysctl.conf

  然后执行sysctl -p 使配置的内核响应参数生效

	sysctl -p

  修改自动挂载文件 配置让swap分区不自动挂载

  修改/etc/fatab 自动挂载文件  注释swap分区的自动挂载 (修改之前先备份)

	cp -p /etc/fstab /etc/fstab.bak
	sed  -i "s|/dev/mapper/centos-swap|# /dev/mapper/centos-swap|" /etc/fstab

然后重启系统 查看内核版本
